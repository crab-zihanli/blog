import{h as V,u as W,i as X,j as Z,k as ee,t as ae,l as se,m as q,p as w,q as e,s as te,v as le,x as re,R as $,y as ie,z as oe,A as ce,B as ue,C as ne,D as I,E as T,F as de,G as ve,H as he,I as me,L as ye,J as pe,K as ge,M as fe,N as M,O as ke,P as x}from"./app-BNHhAPIR.js";const Ee=["/","/intro.html","/code/","/code/ai/","/code/ai/markdown.html","/code/frontend/","/code/frontend/markdown.html","/code/frontend/vuepress-deploy.html","/posts/read/1.html","/posts/read/","/posts/think/3.html","/posts/think/","/404.html","/posts/","/category/","/category/code/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/coding/","/category/frontend/","/category/%E8%8B%B9%E6%9E%9C/","/category/read/","/category/%E9%A6%99%E8%95%89/","/category/think/","/tag/","/tag/markdown/","/tag/git/","/tag/workflow/","/tag/%E7%BA%A2/","/tag/%E5%A4%A7/","/tag/%E5%9C%86/","/tag/%E9%BB%84/","/tag/%E5%BC%AF%E6%9B%B2%E7%9A%84/","/tag/%E9%95%BF/","/article/","/star/","/timeline/"],He="SLIMSEARCH_QUERY_HISTORY",g=M(He,[]),we=()=>{const{queryHistoryCount:l}=x;return{enabled:l>0,queryHistories:g,addQueryHistory:c=>{g.value=Array.from(new Set([c,...g.value.slice(0,l-1)]))},removeQueryHistory:c=>{g.value=[...g.value.slice(0,c),...g.value.slice(c+1)]}}},B=l=>Ee[l.id]+("anchor"in l?`#${l.anchor}`:""),xe="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=x,f=M(xe,[]),Re=()=>({enabled:j>0,resultHistories:f,addResultHistory:o=>{{const c={link:B(o),display:o.display};"header"in o&&(c.header=o.header),f.value=[c,...f.value.slice(0,j-1)]}},removeResultHistory:o=>{f.value=[...f.value.slice(0,o),...f.value.slice(o+1)]}}),Ce=l=>{const{page:o,routeLocale:c}=de(),R=ve(),r=q(0),k=w(()=>r.value>0),d=he([]);return me(()=>{const{search:C,terminate:m}=ye(),E=ge(y=>{const{resultsFilter:Q=t=>t,querySplitter:p,suggestionsFilter:L,...i}=R.value;y?(r.value+=1,C(y,c.value,i).then(t=>Q(t,y,c.value,o.value)).then(t=>{r.value-=1,d.value=t}).catch(t=>{console.warn(t),r.value-=1,r.value||(d.value=[])})):d.value=[]},x.searchDelay-x.suggestDelay,{maxWait:5e3});pe([l,c],([y])=>E(y.join(" "))),fe(()=>{m()})}),{isSearching:k,results:d}};var be=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:o}){const c=W(),R=X(),r=Z(ee),{addQueryHistory:k,queryHistories:d,removeQueryHistory:C}=we(),{resultHistories:m,addResultHistory:E,removeResultHistory:y}=Re(),Q=ae(l,"queries"),{results:p,isSearching:L}=Ce(Q),i=se({isQuery:!0,index:0}),t=q(0),v=q(0),D=w(()=>d.value.length>0||m.value.length>0),b=w(()=>p.value.length>0),A=w(()=>p.value[t.value]||null),O=()=>{const{isQuery:a,index:s}=i;s===0?(i.isQuery=!a,i.index=a?m.value.length-1:d.value.length-1):i.index=s-1},P=()=>{const{isQuery:a,index:s}=i;s===(a?d.value.length-1:m.value.length-1)?(i.isQuery=!a,i.index=0):i.index=s+1},U=()=>{t.value=t.value>0?t.value-1:p.value.length-1,v.value=A.value.contents.length-1},_=()=>{t.value=t.value<p.value.length-1?t.value+1:0,v.value=0},Y=()=>{v.value<A.value.contents.length-1?v.value+=1:_()},z=()=>{v.value>0?v.value-=1:U()},S=a=>a.map(s=>ke(s)?s:e(s[0],s[1])),G=a=>{if(a.type==="customField"){const s=ue[a.index]||"$content",[h,u=""]=ne(s)?s[R.value].split("$content"):s.split("$content");return a.display.map(n=>e("div",S([h,...n,u])))}return a.display.map(s=>e("div",S(s)))},H=()=>{t.value=0,v.value=0,o("updateQuery",""),o("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((a,s)=>{const h=i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h,onClick:()=>{o("updateQuery",a)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},a),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),C(s)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((a,s)=>{const h=!i.isQuery&&i.index===s;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h},e($,{to:a.link,onClick:()=>{H()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[a.header?e("div",{class:"slimsearch-record-content-header"},a.header):null,e("div",a.display.map(u=>S(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),y(s)}})]))}))]));return te("keydown",a=>{if(l.isFocusing){if(b.value){if(a.key==="ArrowUp")z();else if(a.key==="ArrowDown")Y();else if(a.key==="Enter"){const s=A.value.contents[v.value];k(l.queries.join(" ")),E(s),c.push(B(s)),H()}}else if(a.key==="ArrowUp")O();else if(a.key==="ArrowDown")P();else if(a.key==="Enter"){const{index:s}=i;i.isQuery?(a.preventDefault(),o("updateQuery",d.value[s])):(c.push(m.value[s].link),H())}}}),le([t,v],()=>{var a;(a=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||a.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:l.queries.length?!b.value:!D.value}]},l.queries.length?L.value?e(re,{hint:r.value.searching}):b.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:a,contents:s},h)=>{const u=t.value===h;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},a||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},s.map((n,N)=>{const F=u&&v.value===N;return e("li",{class:["slimsearch-record-matches",{active:F}],role:"option","aria-selected":F},e($,{to:B(n),onClick:()=>{k(l.queries.join(" ")),E(n),H()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?oe:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:D.value?[J(),K()]:r.value.emptyHistory)}});export{be as default};
