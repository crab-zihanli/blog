import{h as V,u as W,i as X,j as Z,k as ee,t as se,l as ae,m as D,p as A,q as e,s as te,v as le,x as re,R as $,y as oe,z as ie,A as ce,B as ue,C as ne,D as I,E as T,F as de,G as ve,H as he,I as me,L as ye,J as pe,K as Ee,M as ge,N as M,O as Be,P as H}from"./app-C2RxJPES.js";const fe=["/","/intro.html","/code/","/code/ai/","/code/ai/markdown.html","/code/frontend/","/posts/read/","/posts/read/%E5%A5%87%E9%A3%8E%E5%B0%91%E5%B9%B4.html","/posts/think/3.html","/posts/think/","/code/frontend/vuepress%E9%83%A8%E7%BD%B2/markdown.html","/code/frontend/vuepress%E9%83%A8%E7%BD%B2/vuepress-deploy.html","/code/frontend/vuepress%E9%83%A8%E7%BD%B2/%E4%BF%AE%E6%94%B9md%E7%B2%98%E8%B4%B4%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84.html","/404.html","/posts/","/code/frontend/vuepress%E9%83%A8%E7%BD%B2/","/category/","/category/code/","/category/%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","/category/read/","/category/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/","/category/%E9%A6%99%E8%95%89/","/category/think/","/category/coding/","/category/frontend/","/tag/","/tag/markdown/","/tag/%E6%82%AC%E7%96%91/","/tag/%E5%86%92%E9%99%A9/","/tag/%E6%88%90%E9%95%BF/","/tag/%E9%BB%84/","/tag/%E5%BC%AF%E6%9B%B2%E7%9A%84/","/tag/%E9%95%BF/","/tag/git/","/tag/workflow/","/tag/vscode/","/article/","/star/","/timeline/"],ke="SLIMSEARCH_QUERY_HISTORY",E=M(ke,[]),Ae=()=>{const{queryHistoryCount:l}=H;return{enabled:l>0,queryHistories:E,addQueryHistory:c=>{E.value=Array.from(new Set([c,...E.value.slice(0,l-1)]))},removeQueryHistory:c=>{E.value=[...E.value.slice(0,c),...E.value.slice(c+1)]}}},S=l=>fe[l.id]+("anchor"in l?`#${l.anchor}`:""),He="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:j}=H,g=M(He,[]),we=()=>({enabled:j>0,resultHistories:g,addResultHistory:i=>{{const c={link:S(i),display:i.display};"header"in i&&(c.header=i.header),g.value=[c,...g.value.slice(0,j-1)]}},removeResultHistory:i=>{g.value=[...g.value.slice(0,i),...g.value.slice(i+1)]}}),xe=l=>{const{page:i,routeLocale:c}=de(),w=ve(),r=D(0),B=A(()=>r.value>0),d=he([]);return me(()=>{const{search:x,terminate:m}=ye(),f=Ee(y=>{const{resultsFilter:R=t=>t,querySplitter:p,suggestionsFilter:q,...o}=w.value;y?(r.value+=1,x(y,c.value,o).then(t=>R(t,y,c.value,i.value)).then(t=>{r.value-=1,d.value=t}).catch(t=>{console.warn(t),r.value-=1,r.value||(d.value=[])})):d.value=[]},H.searchDelay-H.suggestDelay,{maxWait:5e3});pe([l,c],([y])=>f(y.join(" "))),ge(()=>{m()})}),{isSearching:B,results:d}};var Ce=V({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(l,{emit:i}){const c=W(),w=X(),r=Z(ee),{addQueryHistory:B,queryHistories:d,removeQueryHistory:x}=Ae(),{resultHistories:m,addResultHistory:f,removeResultHistory:y}=we(),R=se(l,"queries"),{results:p,isSearching:q}=xe(R),o=ae({isQuery:!0,index:0}),t=D(0),v=D(0),F=A(()=>d.value.length>0||m.value.length>0),C=A(()=>p.value.length>0),Q=A(()=>p.value[t.value]||null),O=()=>{const{isQuery:s,index:a}=o;a===0?(o.isQuery=!s,o.index=s?m.value.length-1:d.value.length-1):o.index=a-1},P=()=>{const{isQuery:s,index:a}=o;a===(s?d.value.length-1:m.value.length-1)?(o.isQuery=!s,o.index=0):o.index=a+1},U=()=>{t.value=t.value>0?t.value-1:p.value.length-1,v.value=Q.value.contents.length-1},_=()=>{t.value=t.value<p.value.length-1?t.value+1:0,v.value=0},Y=()=>{v.value<Q.value.contents.length-1?v.value+=1:_()},z=()=>{v.value>0?v.value-=1:U()},b=s=>s.map(a=>Be(a)?a:e(a[0],a[1])),G=s=>{if(s.type==="customField"){const a=ue[s.index]||"$content",[h,u=""]=ne(a)?a[w.value].split("$content"):a.split("$content");return s.display.map(n=>e("div",b([h,...n,u])))}return s.display.map(a=>e("div",b(a)))},k=()=>{t.value=0,v.value=0,i("updateQuery",""),i("close")},J=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},d.value.map((s,a)=>{const h=o.isQuery&&o.index===a;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h,onClick:()=>{i("updateQuery",s)}},e("div",[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),x(a)}})]))}))])),K=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((s,a)=>{const h=!o.isQuery&&o.index===a;return e("li",{class:["slimsearch-record-matches",{active:h}],role:"option","aria-selected":h},e($,{to:s.link,onClick:()=>{k()}},()=>[e(I,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(u=>b(u)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:T,onClick:u=>{u.preventDefault(),u.stopPropagation(),y(a)}})]))}))]));return te("keydown",s=>{if(l.isFocusing){if(C.value){if(s.key==="ArrowUp")z();else if(s.key==="ArrowDown")Y();else if(s.key==="Enter"){const a=Q.value.contents[v.value];B(l.queries.join(" ")),f(a),c.push(S(a)),k()}}else if(s.key==="ArrowUp")O();else if(s.key==="ArrowDown")P();else if(s.key==="Enter"){const{index:a}=o;o.isQuery?(s.preventDefault(),i("updateQuery",d.value[a])):(c.push(m.value[a].link),k())}}}),le([t,v],()=>{var s;(s=document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active"))==null||s.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:l.queries.length?!C.value:!F.value}]},l.queries.length?q.value?e(re,{hint:r.value.searching}):C.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},p.value.map(({title:s,contents:a},h)=>{const u=t.value===h;return e("div",{class:["slimsearch-record",{active:u}],role:"group","aria-selected":u},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},a.map((n,N)=>{const L=u&&v.value===N;return e("li",{class:["slimsearch-record-matches",{active:L}],role:"option","aria-selected":L},e($,{to:S(n),onClick:()=>{B(l.queries.join(" ")),f(n),k()}},()=>[n.type==="text"?null:e(n.type==="title"?oe:n.type==="heading"?ie:ce,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",G(n))])]))}))])})):r.value.emptyResult:F.value?[J(),K()]:r.value.emptyHistory)}});export{Ce as default};
